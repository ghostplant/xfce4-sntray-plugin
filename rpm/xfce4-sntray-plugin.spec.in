Name: @CMAKE_PROJECT_NAME@
Version: @CPACK_PACKAGE_VERSION@
Release: @CPACK_PACKAGE_RELEASE@%{?dist}
Group: User Interface/Desktops
%if %{defined suse_version}
License: LGPL-3.0+
%else
License: LGPLv3.0+
%endif
URL: https://github.com/rilian-la-te/@CMAKE_PROJECT_NAME@
Source: @CPACK_SOURCE_PACKAGE_FILE_NAME@.tar.gz
Summary: This package provides StatusNotifier plugin for xfce4-panel
BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-root
BuildRequires: cmake >= 2.8.0
BuildRequires: gettext
BuildRequires: vala >= 0.24.0
BuildRequires: pkgconfig(gtk+-3.0) >= 3.12.0
BuildRequires: pkgconfig(libpeas-1.0) >= 1.2.0
BuildRequires: pkgconfig(libxfce4panel-2.0)
BuildRequires: pkgconfig(libxfconf-0)
BuildRequires: pkgconfig(vala-panel)
Provides: vala-panel-sntray-plugin

%description
StatusNotifier is new D-Bus standard for system tray.
It is shared both by Ubuntu Unity and KDE.
There is several plugins for show StatusNotifiers for different DEs,
for XFCE it is indicator-application and xfce4-snw-plugin

%prep
%setup -q 

%build
cmake . -DGSETTINGS_COMPILE=OFF -DCMAKE_INSTALL_PREFIX=%{_prefix} -DCMAKE_INSTALL_INCLUDEDIR=%{_includedir} -DCMAKE_INSTALL_LIBDIR=%{_libdir} -DCMAKE_INSTALL_SYSCONFDIR=%{_sysconfdir} -DCMAKE_INSTALL_DATAROOTDIR=%{_datarootdir} -DCMAKE_INSTALL_DATADIR=%{_datadir}
make %{?_smp_mflags}

%install 
make install DESTDIR=%{buildroot}
%find_lang %{name}

%clean
rm -rf %{buildroot}

%files
%defattr(644,root,root,755)
%dir %{_libdir}/xfce4
%dir %{_libdir}/xfce4/panel
%dir %{_libdir}/xfce4/panel/plugins
%dir %{_datadir}/xfce4
%dir %{_datadir}/xfce4/panel
%dir %{_datadir}/xfce4/panel/plugins
%{_libdir}/xfce4/panel/plugins/libsntray-xfce.so
%{_datadir}/xfce4/panel/plugins/sntray.desktop

%package lang
Group: User Interface/Desktops
Summary: Translations for @CMAKE_PROJECT_NAME@
BuildArch: noarch
Requires: vala-panel-sntray-plugin
%description lang
This is a translation files for @CMAKE_PROJECT_NAME@ package.
%files lang -f %{name}.lang
%defattr(644,root,root,755)

%package -n vala-panel-sntray
Group: User Interface/Desktops
Summary: This package provides StatusNotifier plugin for vala-panel
Requires: bamf-daemon
Provides: vala-panel-sntray-plugin
%description -n vala-panel-sntray
StatusNotifier is new D-Bus standard for system tray.
It is shared both by Ubuntu Unity and KDE.
There is several plugins for show StatusNotifiers for different DEs,
but for vala-panel only this implementation exists yet.
%files -n vala-panel-sntray
%defattr(644,root,root,755)
%doc README.md
%{_datadir}/glib-2.0/schemas/org.valapanel.toplevel.sntray.gschema.xml
%dir %{_libdir}/vala-panel
%dir %{_libdir}/vala-panel/applets
%{_libdir}/vala-panel/applets/libsntray-valapanel.so
%{_libdir}/vala-panel/applets/sntray.plugin

%postun -n vala-panel-sntray
set -o monitor
if [ $1 -eq 0 ] ; then
    /usr/bin/glib-compile-schemas %{_datadir}/glib-2.0/schemas &> /dev/null || :
fi

%posttrans -n vala-panel-sntray
set -o monitor
/usr/bin/glib-compile-schemas %{_datadir}/glib-2.0/schemas &> /dev/null || :

%changelog
* Mon Apr 27 2015 Konstantin <ria.freelander@gmail.com> - @CPACK_PACKAGE_VERSION@
  Generated by CMake UseRPMTools macros
